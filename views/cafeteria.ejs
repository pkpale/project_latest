<html lang="en">
    <head>
        <!-- head start  -->
        
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Placement Session 2020 </title>
        <!-- Latest compiled and minified CSS -->
        <!-- Latest compiled and minified CSS -->

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <link href='/styles.css' type="text/css" rel='stylesheet'>
        <!-- <link href='/bootstrap.min.css' rel='stylesheet'> -->
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        
        <!-- head end  -->
    </head>
    <style>
        .seats{
            border-radius: 15%;
            margin-right: 1%;
            margin-bottom: 0;
            width: 15%;
            border-color: gray;
            background-color: gray;
            height: 10%;   
        }
        .seats:hover {
            cursor: grab;
            background-color: green;
        }
        .path {
            background-color: transparent;
        }
        .cafeteria-row {
            margin-top: 0;
            padding-top: 0.5%;
            padding-bottom: 0.5%;
        }
        .cafeteria-blank-row {
            height: 5%;
        }        
    </style>
<body >
    <div class="container-fluid cont ">
            <!-- nav start  -->
            <style>
                .ac:hover{
                    background-color: grey;
                    color: white;
                }
            </style>


            <nav class="navbar navbar-default navbar-fixed-top ">
                <div class="container-fluid ">
                    <div class="navbar-header">
                        <button type = "button" class="navbar-toggle " data-toggle="collapse" data-target="#list">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a href='/' class="navbar-brand">
                            <img src="/logo.png" alt="">
                        </a>
                    </div>

                    <div class="collapse navbar-collapse" id="list">
                        <ul class="nav navbar-nav">
                            <li class=" ac"><a href='/'>Home</a></li>
                            <li class=" ac"><a href='/about'>About</a></li>
                            <li class=" ac"><a href='/contact-us'>Contact us</a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right user-login">
                            <li ><a href="/"><span class="glyphicon glyphicon-user "></span> Sign Up</a></li>
                            <li><a href="/login"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right user-login" style="display: none;">
                        
                            <li><a href="/login"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
                        </ul>
                    </div>
                </div>
                
            </nav>


            <script>
                const icon = document.getElementsByClassName('user-login');
                
                    if(String(sessionStorage.getItem('status')) == "null" ){
                        icon[0].style.display="";
                        icon[1].style.display = "none";
                        console.log('nav');

                    }
                    else{
                        icon[0].style.display="none";
                        icon[1].style.display = "";
                        icon[1].addEventListener('click', ()=>{
                            sessionStorage.setItem('status',null);
                            window.location.href = '/login';
                        });
                    }    
                
            </script>

            <!-- nav end  -->

            <div class="container-fluid back">
                <div class="container main-cont  ">
                    <div class="row cafeteria-row">
                         <div class= "col-xs-2 seats" onclick="Myfun(1)">
                             
                         </div>
                         <div class= "col-xs-2 seats" onclick="Myfun(2)">
                             
                        </div>
                        <div class= "col-xs-2 path" >
                             
                        </div>
                        <div class= "col-xs-2 path">
                            
                       </div>
                       <div class= "col-xs-2 seats" onclick="Myfun(3)">
                             
                        </div>
                        <div class= "col-xs-2 seats" onclick="Myfun(4)">
                            
                        </div>
                    </div>
                    <div class="row cafeteria-row">
                        <div class= "col-xs-2 seats" onclick="Myfun(5)">
                             
                        </div>
                        <div class= "col-xs-2 seats" onclick="Myfun(6)">
                            
                       </div>
                       <div class= "col-xs-2 path">
                            
                       </div>
                       <div class= "col-xs-2 path">
                           
                      </div>
                      <div class= "col-xs-2 seats" onclick="Myfun(7)">
                            
                       </div>
                       <div class= "col-xs-2 seats" onclick="Myfun(8)">
                           
                       </div>
                   </div>
                   <div class="row cafeteria-blank-row">

                    </div>
                    <div class="row cafeteria-row">
                        <div class= "col-xs-2 seats" onclick="Myfun(9)">
                             
                        </div>
                        <div class= "col-xs-2 seats" onclick="Myfun(10)">
                            
                       </div>
                       <div class= "col-xs-2 path" >
                            
                       </div>
                       <div class= "col-xs-2 path">
                           
                      </div>
                      <div class= "col-xs-2 seats" onclick="Myfun(11)">
                            
                       </div>
                       <div class= "col-xs-2 seats" onclick="Myfun(12)">
                           
                       </div>
                    </div>
                    <div class="row cafeteria-row">
                        <div class= "col-xs-2 seats" onclick="Myfun(13)">
                             
                        </div>
                        <div class= "col-xs-2 seats" onclick="Myfun(14)">
                            
                       </div>
                       <div class= "col-xs-2 path">
                            
                       </div>
                       <div class= "col-xs-2 path">
                           
                      </div>
                      <div class= "col-xs-2 seats" onclick="Myfun(15)">
                            
                       </div>
                       <div class= "col-xs-2 seats" onclick="Myfun(16)">
                           
                       </div>
                    </div>
                    <div class="row cafeteria-blank-row">

                    </div>
                    <div class="row ">
                        <div class="col-xs-7" style="background-color: aquamarine;">
                            <p style="text-align:center; word-spacing: 10%;">RECEPTION</p>
                        </div>
                        <div class="col-xs-2" >
                            
                        </div>
                        <div class="col-xs-2 " style=" text-align: center;">
                            <button class="btn btn-success" id='save'>
                                SAVE 
                            </button>
                        </div>
                    </div>
                   
                </div>
                
            </div>
            
    </div>
    
    
    <script>

        //catching the data from render function 
        // console.log('<%- JSON.stringify(data) %>')
        console.log("other data", '<%- JSON.stringify(data1) %>')
        if ( '<%- JSON.stringify(data) %>' != undefined) {
            var data = '<%- JSON.stringify(data) %>'; 

            var data1 = '<%- JSON.stringify(data1) %>';
            data1 = JSON.parse(data1);
            console.log(data1)
            if(data1 != undefined) {
                for( var i=0;i < data1.length; i++) {
                    document.getElementsByClassName('seats')[data1[i].cafeteria_seat].style.backgroundColor = "red"
                }
                // console.log(data1.cafeteria_seat)
                // document.getElementsByClassName('seats')[data1.cafeteria_seat].style.backgroundColor = "red"
            }
            // if
            console.log("sahrma," ,data)
            data=JSON.parse(data);
            console.log(data, "ravi");
            var x = data.cafeteria_seat;
            console.log("ravi", x)
            if(x != 'undefined' && x != 'null') // not undefined
            {
                document.getElementsByClassName('seats')[x].style.backgroundColor = "green"
            }
        }

        Myfun = (seat_number) => {
            let already_selected=false;
            if (document.getElementsByClassName('seats')[seat_number-1].style.backgroundColor == 'red') {
                alert("oops: booked by someone else already")
                return;
            }
            for(var i=0;i<16;i++) {
                if (document.getElementsByClassName('seats')[i].style.backgroundColor == 'green')
                 {
                    already_selected=true;
                    // alert("already_selected");
                 }   
            }
            if (document.getElementsByClassName('seats')[seat_number-1].style.backgroundColor == 'green') {
                 // alert("Can only select one seat --- 3");
                already_selected = false;
                document.getElementsByClassName('seats')[seat_number-1].style.backgroundColor = "gray";
            }
            else {
               // alert("Can only select one seat --- 1");
               if(already_selected) {
                    alert("Can only select one seat");
                }
                else {
                    already_selected = true;
                    document.getElementsByClassName('seats')[seat_number-1].style.backgroundColor = "green";
                }
            }
        }

        var save  = document.querySelector('#save');

        save.addEventListener('click', ()=>{
            var seat_no;
            for(var i=0;i<16;i++) {
                if (document.getElementsByClassName('seats')[i].style.backgroundColor == 'green')
                 {
                    seat_no = i;
                    // alert("already_selected");
                 }   
            }
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var response = JSON.parse(this.responseText);
                        window.location.href = `/user/${data.emailid}`;                      
                    }
            }
            console.log(data)
            var email = data.emailid;
            console.log("sahrma", email);
            xhttp.open("POST", `/user/save/${email}`, true);
        
            xhttp.setRequestHeader("seat_no",`${seat_no}`);
            
            xhttp.send();
    });
    </script>


    <!-- footer start  -->
    <footer>
        <div >
            <!-- <a href='linkedin.com/in/rvishrm/'> -->
            <a href='http://linkedin.com/in/rvishrm/''>
                <i class="fa fa-linkedin" ></i>
            </a>
            <a href='https://twitter.com/rvishrm'>
                <i class="fa fa-twitter" ></i>
            </a>
            <!-- use of http is must -->
            <a href='https://www.instagram.com/i_m_rs_38/'>
                <i class="fa fa-instagram"></i>
            </a>   
        </div>
        <div>
            copyright &copy; rvishrm 2020
        </div>
    </footer>
    <!-- footer end  -->
    
</body>
</html>